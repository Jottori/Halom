<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\HalomRoleManager.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> HalomRoleManager.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">26.67% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>8/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">5.88% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>2/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">25% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">19.05% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>8/42</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/Pausable.sol";
&nbsp;
/**
 * @title HalomRoleManager
 * @dev Centralized role management for the Halom ecosystem
 * Implements secure role separation and governance controls
 */
contract HalomRoleManager is AccessControl, Pausable {
    
    // Core roles - never assigned to individual wallets
    bytes32 public constant GOVERNOR_ROLE = keccak256("GOVERNOR_ROLE");
    
    // Token management roles
    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");
    bytes32 public constant REBASE_CALLER = keccak256("REBASE_CALLER");
    bytes32 public constant STAKING_CONTRACT_ROLE = keccak256("STAKING_CONTRACT_ROLE");
    
    // Oracle roles
    bytes32 public constant ORACLE_UPDATER_ROLE = keccak256("ORACLE_UPDATER_ROLE");
    
    // Governance and slashing roles
    bytes32 public constant SLASHER_ROLE = keccak256("SLASHER_ROLE");
    
    // Reward management roles
    bytes32 public constant REWARDER_ROLE = keccak256("REWARDER_ROLE");
    
    // Treasury management roles
    bytes32 public constant TREASURY_CONTROLLER = keccak256("TREASURY_CONTROLLER");
    
    // Emergency roles
    bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE");
    bytes32 public constant EMERGENCY_ROLE = keccak256("EMERGENCY_ROLE");
    
    // Role assignment tracking
    mapping(bytes32 =&gt; address[]) public roleAssignments;
    mapping(bytes32 =&gt; bool) public roleFrozen;
    
    // Events
    event RoleFrozen(bytes32 indexed role, address indexed frozenBy);
    event RoleUnfrozen(bytes32 indexed role, address indexed unfrozenBy);
    event ContractRoleAssigned(bytes32 indexed role, address indexed contractAddress, address indexed assignedBy);
    event HumanRoleRevoked(bytes32 indexed role, address indexed account, address indexed revokedBy);
    
    constructor(address _timelock, address _governor) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_timelock != address(0), "Timelock cannot be zero");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_governor != address(0), "Governor cannot be zero");
        
        // Only Timelock gets DEFAULT_ADMIN_ROLE
        _grantRole(DEFAULT_ADMIN_ROLE, _timelock);
        
        // Governor gets GOVERNOR_ROLE
        _grantRole(GOVERNOR_ROLE, _governor);
        
        // Governor can pause/unpause
        _grantRole(PAUSER_ROLE, _governor);
        
        // Emergency role for critical situations
        _grantRole(EMERGENCY_ROLE, _governor);
    }
    
    /**
     * @dev Grant role to contract only (no human addresses)
     */
<span class="fstat-no" title="function not covered" >    function grantRoleToContract(bytes32 role, address contractAddress) external onlyRole(GOVERNOR_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(contractAddress != address(0), "Contract address cannot be zero")</span>;
<span class="cstat-no" title="statement not covered" >        require(contractAddress.code.length &gt; 0, "Address must be a contract")</span>;
<span class="cstat-no" title="statement not covered" >        require(!roleFrozen[role], "Role is frozen")</span>;
        
<span class="cstat-no" title="statement not covered" >        _grantRole(role, contractAddress)</span>;
<span class="cstat-no" title="statement not covered" >        roleAssignments[role].push(contractAddress)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit ContractRoleAssigned(role, contractAddress, msg.sender);</span>
    }
    
    /**
     * @dev Revoke role from human address (security measure)
     */
<span class="fstat-no" title="function not covered" >    function revokeRoleFromHuman(bytes32 role, address account) external onlyRole(GOVERNOR_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(account.code.length == 0, "Cannot revoke from contract")</span>;
<span class="cstat-no" title="statement not covered" >        require(hasRole(role, account), "Account does not have role")</span>;
        
<span class="cstat-no" title="statement not covered" >        _revokeRole(role, account)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit HumanRoleRevoked(role, account, msg.sender);</span>
    }
    
    /**
     * @dev Freeze a role to prevent further assignments
     */
<span class="fstat-no" title="function not covered" >    function freezeRole(bytes32 role) external onlyRole(GOVERNOR_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(!roleFrozen[role], "Role already frozen")</span>;
        roleFrozen[role] = true;
        
<span class="cstat-no" title="statement not covered" >        emit RoleFrozen(role, msg.sender);</span>
    }
    
    /**
     * @dev Unfreeze a role (only in emergency)
     */
<span class="fstat-no" title="function not covered" >    function unfreezeRole(bytes32 role) external onlyRole(EMERGENCY_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        require(roleFrozen[role], "Role not frozen")</span>;
        roleFrozen[role] = false;
        
<span class="cstat-no" title="statement not covered" >        emit RoleUnfrozen(role, msg.sender);</span>
    }
    
    /**
     * @dev Get all addresses with a specific role
     */
<span class="fstat-no" title="function not covered" >    function getRoleMembers(bytes32 role) external view returns (address[] memory) {</span>
<span class="cstat-no" title="statement not covered" >        return roleAssignments[role];</span>
    }
    
    /**
     * @dev Check if role is frozen
     */
<span class="fstat-no" title="function not covered" >    function isRoleFrozen(bytes32 role) external view returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        return roleFrozen[role];</span>
    }
    
    /**
     * @dev Override grantRole to prevent direct usage
     */
    function grantRole(bytes32 role, address account) public virtual override {
        revert("Use grantRoleToContract for contracts or specific functions for humans");
    }
    
    /**
     * @dev Override revokeRole to prevent direct usage
     */
    function revokeRole(bytes32 role, address account) public virtual override {
        revert("Use revokeRoleFromHuman for humans or specific functions for contracts");
    }
    
    /**
     * @dev Pause role management (emergency)
     */
<span class="fstat-no" title="function not covered" >    function pause() external onlyRole(PAUSER_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _pause()</span>;
    }
    
    /**
     * @dev Unpause role management
     */
<span class="fstat-no" title="function not covered" >    function unpause() external onlyRole(GOVERNOR_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _unpause()</span>;
    }
    
    /**
     * @dev Emergency function to revoke all roles from an address
     */
<span class="fstat-no" title="function not covered" >    function emergencyRevokeAllRoles(address account) external onlyRole(EMERGENCY_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        bytes32[] memory allRoles = new bytes32[](10);</span>
        allRoles[0] = MINTER_ROLE;
        allRoles[1] = REBASE_CALLER;
        allRoles[2] = STAKING_CONTRACT_ROLE;
        allRoles[3] = ORACLE_UPDATER_ROLE;
        allRoles[4] = SLASHER_ROLE;
        allRoles[5] = REWARDER_ROLE;
        allRoles[6] = TREASURY_CONTROLLER;
        allRoles[7] = PAUSER_ROLE;
        allRoles[8] = GOVERNOR_ROLE;
        allRoles[9] = EMERGENCY_ROLE;
        
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; allRoles.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >            if (hasRole(allRoles[i], account)) {</span>
<span class="cstat-no" title="statement not covered" >                _revokeRole(allRoles[i], account)</span>;
            }
        }
    }
} </pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jun 28 2025 13:18:46 GMT+0200 (közép-európai nyári idő)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
