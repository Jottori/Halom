<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\HalomLPStaking.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> HalomLPStaking.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">92.16% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>47/51</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">56% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>28/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">76.92% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>10/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.3% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>63/73</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-yes">91×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">762×</span>
<span class="cline-any cline-yes">762×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "./interfaces/IHalomInterfaces.sol";
&nbsp;
contract HalomLPStaking is AccessControl, ReentrancyGuard {
    using SafeERC20 for IERC20;
&nbsp;
    bytes32 public constant GOVERNOR_ROLE = keccak256("GOVERNOR_ROLE");
    bytes32 public constant REWARDER_ROLE = keccak256("REWARDER_ROLE");
    bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE");
&nbsp;
    IERC20 public immutable lpToken;
    IHalomToken public immutable halomToken;
    IHalomRoleManager public roleManager;
    uint256 public rewardRate;
&nbsp;
    uint256 public totalStaked;
    mapping(address =&gt; uint256) public stakedBalance;
&nbsp;
    // Fourth root based reward system
    uint256 public totalFourthRootStake; // Sum of fourth roots of all stakes
    mapping(address =&gt; uint256) public fourthRootStake; // Fourth root of user's stake
    uint256 public rewardsPerFourthRoot; // Rewards per fourth root unit
    mapping(address =&gt; uint256) public rewardDebt;
&nbsp;
    // Emergency recovery
    uint256 public pendingRewards; // Rewards waiting for first staker
&nbsp;
    event Staked(address indexed user, uint256 amount);
    event Unstaked(address indexed user, uint256 amount);
    event RewardAdded(address indexed rewarder, uint256 amount);
    event RewardClaimed(address indexed user, uint256 amount);
    event EmergencyRecovery(address indexed token, address indexed to, uint256 amount);
    event PendingRewardsClaimed(address indexed user, uint256 amount);
&nbsp;
    constructor(
        address _lpToken,
        address _halomToken,
        address _roleManager,
        uint256 _rewardRate
    ) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_lpToken != address(0),
            "LP token is zero address"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_halomToken != address(0),
            "Halom token is zero address"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_roleManager != address(0),
            "Role manager is zero address"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_rewardRate &gt; 0,
            "Reward rate must be greater than 0"
        );
&nbsp;
        lpToken = IERC20(_lpToken);
        halomToken = IHalomToken(_halomToken);
        roleManager = IHalomRoleManager(_roleManager);
        rewardRate = _rewardRate;
        
        // Roles will be granted by deployment script, not in constructor
        _grantRole(DEFAULT_ADMIN_ROLE, _roleManager);
        _grantRole(GOVERNOR_ROLE, _roleManager);
        _grantRole(REWARDER_ROLE, _roleManager);
        _grantRole(PAUSER_ROLE, _roleManager);
    }
&nbsp;
    /**
     * @dev Calculate fourth root using Babylonian method
     */
    function fourthRoot(uint256 x) public pure returns (uint256) {
        if (x == 0) return 0;
        uint256 z = x;
        uint256 y = (z + 3) / 4;
        
        while (y &lt; z) {
            z = y;
            y = (3 * z + x / (z * z * z)) / 4;
        }
        return z;
    }
&nbsp;
    /**
     * @dev Get governance power (fourth root of stake)
     */
    function getGovernancePower(address user) public view returns (uint256) {
        return fourthRoot(stakedBalance[user]);
    }
&nbsp;
    modifier updateRewards(address _account) {
        uint256 pending = (fourthRootStake[_account] * rewardsPerFourthRoot) / 1e18 - rewardDebt[_account];
        if (pending &gt; 0) {
            SafeERC20.safeTransfer(IERC20(address(halomToken)), _account, pending);
            emit RewardClaimed(_account, pending);
        }
        _;
        rewardDebt[_account] = (fourthRootStake[_account] * rewardsPerFourthRoot) / 1e18;
    }
&nbsp;
    function stake(uint256 _amount) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>updateRewards(msg.sender) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_amount &gt; 0, "Cannot stake 0");
        
        // If this is the first staker and there are pending rewards, distribute them
        <span class="missing-if-branch" title="if path not taken" >I</span>if (totalStaked == 0 &amp;&amp; pendingRewards &gt; 0) {
            rewardsPerFourthRoot = (pendingRewards * 1e18) / fourthRoot(_amount);
            pendingRewards = 0;
<span class="cstat-no" title="statement not covered" >            emit PendingRewardsClaimed(msg.sender, pendingRewards);</span>
        }
        
        // Calculate old and new fourth root values
        uint256 oldFourthRoot = fourthRootStake[msg.sender];
        uint256 newStake = stakedBalance[msg.sender] + _amount;
        uint256 newFourthRoot = fourthRoot(newStake);
        
        // Update totals
        totalStaked += _amount;
        totalFourthRootStake = totalFourthRootStake - oldFourthRoot + newFourthRoot;
        
        // Update user state
        stakedBalance[msg.sender] = newStake;
        fourthRootStake[msg.sender] = newFourthRoot;
        
        lpToken.safeTransferFrom(msg.sender, address(this), _amount);
        emit Staked(msg.sender, _amount);
    }
&nbsp;
    function unstake(uint256 _amount) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>updateRewards(msg.sender) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_amount &gt; 0, "Cannot unstake 0");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(stakedBalance[msg.sender] &gt;= _amount, "Insufficient staked balance");
        
        // Calculate old and new fourth root values
        uint256 oldFourthRoot = fourthRootStake[msg.sender];
        uint256 newStake = stakedBalance[msg.sender] - _amount;
        uint256 newFourthRoot = fourthRoot(newStake);
        
        // Update totals
        totalStaked -= _amount;
        totalFourthRootStake = totalFourthRootStake - oldFourthRoot + newFourthRoot;
        
        // Update user state
        stakedBalance[msg.sender] = newStake;
        fourthRootStake[msg.sender] = newFourthRoot;
        
        lpToken.safeTransfer(msg.sender, _amount);
        emit Unstaked(msg.sender, _amount);
    }
    
    function claimRewards() external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>updateRewards(msg.sender) {
        // The updateRewards modifier handles the logic
    }
&nbsp;
    function addRewards(uint256 _amount) external onlyRole(REWARDER_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_amount &gt; 0, "Cannot add 0 rewards");
        SafeERC20.safeTransferFrom(IERC20(address(halomToken)), msg.sender, address(this), _amount);
        <span class="missing-if-branch" title="if path not taken" >I</span>if (totalFourthRootStake == 0) {
            pendingRewards += _amount;
<span class="cstat-no" title="statement not covered" >            emit RewardAdded(msg.sender, _amount);</span>
        } else {
            rewardsPerFourthRoot += (_amount * 1e18) / totalFourthRootStake;
            emit RewardAdded(msg.sender, _amount);
        }
    }
&nbsp;
    function getPendingRewardsForUser(address _account) external view returns (uint256) {
        return (fourthRootStake[_account] * rewardsPerFourthRoot) / 1e18 - rewardDebt[_account];
    }
&nbsp;
    /**
     * @dev Emergency recovery function to withdraw tokens sent by mistake
     * @param _token Token address to recover
     * @param _to Address to send tokens to
     * @param _amount Amount to recover
     */
    function emergencyRecovery(
        address _token,
        address _to,
        uint256 _amount
    ) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(GOVERNOR_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_to != address(0),
            "Cannot recover to zero address"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_amount &gt; 0,
            "Cannot recover 0 amount"
        );
        // Prevent recovery of staked LP tokens
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_token != address(lpToken),
            "Cannot recover staked LP tokens"
        );
        // For reward tokens, only allow recovery of excess amounts
        <span class="missing-if-branch" title="else path not taken" >E</span>if (_token == address(halomToken)) {
            uint256 contractBalance = halomToken.balanceOf(address(this));
            uint256 requiredBalance = pendingRewards;
            <span class="missing-if-branch" title="else path not taken" >E</span>require(
                _amount &lt;= contractBalance - requiredBalance,
                "Cannot recover required rewards"
            );
        }
        
        IERC20(_token).safeTransfer(_to, _amount);
        emit EmergencyRecovery(_token, _to, _amount);
    }
&nbsp;
    /**
     * @dev Get pending rewards for first staker
     */
<span class="fstat-no" title="function not covered" >    function getPendingRewards() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return pendingRewards;</span>
    }
&nbsp;
    /**
     * @dev Get total contract balances
     */
<span class="fstat-no" title="function not covered" >    function getContractBalances() external view returns (</span>
        uint256 lpTokenBalance,
        uint256 halomTokenBalance,
        uint256 pendingRewardsBalance
    ) {
        lpTokenBalance = lpToken.balanceOf(address(this));
        halomTokenBalance = halomToken.balanceOf(address(this));
        pendingRewardsBalance = pendingRewards;
    }
&nbsp;
    /**
     * @dev Get total fourth root stake
     */
<span class="fstat-no" title="function not covered" >    function getTotalFourthRootStake() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return totalFourthRootStake;</span>
    }
} </pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jun 28 2025 13:18:46 GMT+0200 (közép-európai nyári idő)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
