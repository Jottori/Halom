<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for staking\LPStaking.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">staking/</a> LPStaking.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/58</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/64</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/17</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/91</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/utils/ReentrancyGuardUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/token/ERC20/ERC20Upgradeable.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol";
import "../libraries/GovernanceMath.sol";
import "../libraries/GovernanceErrors.sol";
&nbsp;
/**
 * @title LPStaking
 * @dev LP token staking contract for Halom protocol with reward distribution and emergency controls
 */
contract LPStaking is 
    Initializable, 
    PausableUpgradeable, 
    AccessControlUpgradeable, 
    UUPSUpgradeable,
    ReentrancyGuardUpgradeable 
{
    using SafeERC20 for ERC20Upgradeable;
    using GovernanceMath for uint256;
    
    // Role definitions
    bytes32 public constant GOVERNOR_ROLE = keccak256("GOVERNOR_ROLE");
    bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE");
&nbsp;
    // Token contracts
    ERC20Upgradeable public lpToken;
    ERC20Upgradeable public rewardToken;
    
    // LP Staking data
    mapping(address =&gt; uint256) public lpStakedAmount;
    mapping(address =&gt; uint256) public lpRewardDebt;
    mapping(address =&gt; uint256) public lpLastClaimTime;
    mapping(address =&gt; uint256) public lpLockEndTime;
    mapping(address =&gt; uint256) public lpLockBoost;
    
    uint256 public totalLPStaked;
    uint256 public lpRewardRate; // rewards per second per LP token
    uint256 public lpLastUpdateTime;
    uint256 public lpRewardPerTokenStored;
    
    // LP Staking constants
    uint256 public constant MIN_LP_STAKE_AMOUNT = 1e18;
    uint256 public constant MAX_LP_LOCK_DURATION = 365 days;
    uint256 public constant MIN_LP_LOCK_DURATION = 1 days;
    uint256 public constant MAX_LP_LOCK_BOOST = 250; // 2.5x boost
    uint256 public constant LP_BOOST_PRECISION = 100;
    
    // Events
    event LPStaked(address indexed user, uint256 amount, uint256 lockDuration);
    event LPUnstaked(address indexed user, uint256 amount);
    event LPRewardClaimed(address indexed user, uint256 amount);
    event LPRewardCompounded(address indexed user, uint256 amount);
    event EmergencyLPWithdrawn(address indexed user, uint256 amount);
    event LPRewardRateSet(uint256 newRate);
    
    // Errors
    error InsufficientBalance();
    error ZeroAmount();
    error TransferFailed();
    error NoLPRewardsToClaim();
    error LPLockNotExpired();
    error InvalidLPLockDuration();
    error LPStakingPaused();
&nbsp;
    /// @custom:oz-upgrades-unsafe-allow constructor
<span class="fstat-no" title="function not covered" >    constructor() {</span>
<span class="cstat-no" title="statement not covered" >        _disableInitializers()</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function initialize(</span>
        address _lpToken,
        address _rewardToken,
        address admin
    ) public initializer {
<span class="cstat-no" title="statement not covered" >        __Pausable_init()</span>;
<span class="cstat-no" title="statement not covered" >        __AccessControl_init()</span>;
<span class="cstat-no" title="statement not covered" >        __UUPSUpgradeable_init()</span>;
<span class="cstat-no" title="statement not covered" >        __ReentrancyGuard_init()</span>;
        
<span class="cstat-no" title="statement not covered" >        _grantRole(DEFAULT_ADMIN_ROLE, admin)</span>;
<span class="cstat-no" title="statement not covered" >        _grantRole(GOVERNOR_ROLE, admin)</span>;
<span class="cstat-no" title="statement not covered" >        _grantRole(PAUSER_ROLE, admin)</span>;
&nbsp;
        lpToken = ERC20Upgradeable(_lpToken);
        rewardToken = ERC20Upgradeable(_rewardToken);
        lpLastUpdateTime = block.timestamp;
    }
    
    // ============ PUBLIC FUNCTIONS ============
&nbsp;
    /**
     * @dev Stake LP tokens to earn rewards
     */
<span class="fstat-no" title="function not covered" >    function stakeLP(uint256 amount, uint256 lockDuration) </span>
        external 
        whenNotPaused 
        nonReentrant 
    {
<span class="cstat-no" title="statement not covered" >        if (amount &lt; MIN_LP_STAKE_AMOUNT) revert ZeroAmount();</span>
<span class="cstat-no" title="statement not covered" >        if (lockDuration &lt; MIN_LP_LOCK_DURATION || lockDuration &gt; MAX_LP_LOCK_DURATION) {</span>
            revert InvalidLPLockDuration();
        }
<span class="cstat-no" title="statement not covered" >        if (lpToken.balanceOf(msg.sender) &lt; amount) revert InsufficientBalance();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        _updateLPRewards(msg.sender)</span>;
        
        // Calculate lock boost
<span class="cstat-no" title="statement not covered" >        uint256 lockBoost = GovernanceMath.calculateLockBoost(</span>
            lockDuration, 
            MAX_LP_LOCK_DURATION, 
            MAX_LP_LOCK_BOOST
        );
<span class="cstat-no" title="statement not covered" >        uint256 effectiveAmount = amount * lockBoost / LP_BOOST_PRECISION;</span>
        
        lpStakedAmount[msg.sender] += effectiveAmount;
        lpLockEndTime[msg.sender] = block.timestamp + lockDuration;
        lpLockBoost[msg.sender] = lockBoost;
        totalLPStaked += effectiveAmount;
        
<span class="cstat-no" title="statement not covered" >        lpToken.safeTransferFrom(msg.sender, address(this), amount)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit LPStaked(msg.sender, amount, lockDuration);</span>
    }
    
    /**
     * @dev Unstake LP tokens
     */
<span class="fstat-no" title="function not covered" >    function unstakeLP(uint256 amount) </span>
        external 
        whenNotPaused 
        nonReentrant 
    {
<span class="cstat-no" title="statement not covered" >        if (amount == 0) revert ZeroAmount();</span>
<span class="cstat-no" title="statement not covered" >        if (lpStakedAmount[msg.sender] &lt; amount) revert InsufficientBalance();</span>
<span class="cstat-no" title="statement not covered" >        if (block.timestamp &lt; lpLockEndTime[msg.sender]) revert LPLockNotExpired();</span>
        
<span class="cstat-no" title="statement not covered" >        _updateLPRewards(msg.sender)</span>;
        
<span class="cstat-no" title="statement not covered" >        uint256 actualAmount = amount * LP_BOOST_PRECISION / lpLockBoost[msg.sender];</span>
        lpStakedAmount[msg.sender] -= amount;
        totalLPStaked -= amount;
        
<span class="cstat-no" title="statement not covered" >        if (lpStakedAmount[msg.sender] == 0) {</span>
            lpLockBoost[msg.sender] = 0;
        }
        
<span class="cstat-no" title="statement not covered" >        lpToken.safeTransfer(msg.sender, actualAmount)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit LPUnstaked(msg.sender, actualAmount);</span>
    }
    
    /**
     * @dev Claim accumulated LP rewards
     */
<span class="fstat-no" title="function not covered" >    function claimLPRewards() </span>
        external 
        whenNotPaused 
        nonReentrant 
    {
<span class="cstat-no" title="statement not covered" >        _updateLPRewards(msg.sender)</span>;
        
<span class="cstat-no" title="statement not covered" >        uint256 rewards = lpRewardDebt[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        if (rewards == 0) revert NoLPRewardsToClaim();</span>
        
        lpRewardDebt[msg.sender] = 0;
        lpLastClaimTime[msg.sender] = block.timestamp;
        
<span class="cstat-no" title="statement not covered" >        rewardToken.safeTransfer(msg.sender, rewards)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit LPRewardClaimed(msg.sender, rewards);</span>
    }
    
    /**
     * @dev Compound LP rewards back into staking
     */
<span class="fstat-no" title="function not covered" >    function compoundLPRewards() </span>
        external 
        whenNotPaused 
        nonReentrant 
    {
<span class="cstat-no" title="statement not covered" >        _updateLPRewards(msg.sender)</span>;
        
<span class="cstat-no" title="statement not covered" >        uint256 rewards = lpRewardDebt[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        if (rewards == 0) revert NoLPRewardsToClaim();</span>
        
        lpRewardDebt[msg.sender] = 0;
        lpLastClaimTime[msg.sender] = block.timestamp;
        
        // Add rewards to staked amount
        lpStakedAmount[msg.sender] += rewards;
        totalLPStaked += rewards;
        
<span class="cstat-no" title="statement not covered" >        emit LPRewardCompounded(msg.sender, rewards);</span>
    }
    
    // ============ ROLE-BASED FUNCTIONS ============
&nbsp;
    /**
     * @dev Set LP reward rate - only GOVERNOR_ROLE
     */
<span class="fstat-no" title="function not covered" >    function setLPRewardRate(uint256 rate) </span>
        external 
        onlyRole(GOVERNOR_ROLE) 
    {
<span class="cstat-no" title="statement not covered" >        _updateLPRewardPerToken()</span>;
        lpRewardRate = rate;
<span class="cstat-no" title="statement not covered" >        emit LPRewardRateSet(rate);</span>
    }
&nbsp;
    /**
     * @dev Emergency withdraw all LP staked tokens - only GOVERNOR_ROLE
     */
<span class="fstat-no" title="function not covered" >    function emergencyLPWithdraw() </span>
        external 
        onlyRole(GOVERNOR_ROLE) 
        nonReentrant 
    {
<span class="cstat-no" title="statement not covered" >        uint256 amount = lpStakedAmount[msg.sender];</span>
<span class="cstat-no" title="statement not covered" >        if (amount == 0) revert ZeroAmount();</span>
        
<span class="cstat-no" title="statement not covered" >        uint256 actualAmount = amount * LP_BOOST_PRECISION / lpLockBoost[msg.sender];</span>
        lpStakedAmount[msg.sender] = 0;
        totalLPStaked -= amount;
        lpRewardDebt[msg.sender] = 0;
        lpLockBoost[msg.sender] = 0;
        
<span class="cstat-no" title="statement not covered" >        lpToken.safeTransfer(msg.sender, actualAmount)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit EmergencyLPWithdrawn(msg.sender, actualAmount);</span>
    }
    
    /**
     * @dev Pause LP staking - only PAUSER_ROLE
     */
<span class="fstat-no" title="function not covered" >    function pause() external onlyRole(PAUSER_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _pause()</span>;
    }
    
    /**
     * @dev Unpause LP staking - only PAUSER_ROLE
     */
<span class="fstat-no" title="function not covered" >    function unpause() external onlyRole(PAUSER_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _unpause()</span>;
    }
&nbsp;
    // ============ INTERNAL FUNCTIONS ============
&nbsp;
    /**
     * @dev Update LP rewards for a user
     */
<span class="fstat-no" title="function not covered" >    function _updateLPRewards(address user) internal {</span>
<span class="cstat-no" title="statement not covered" >        _updateLPRewardPerToken()</span>;
        
<span class="cstat-no" title="statement not covered" >        if (lpStakedAmount[user] &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >            uint256 earned = lpStakedAmount[user] * (lpRewardPerTokenStored - lpRewardDebt[user]) / 1e18;</span>
            lpRewardDebt[user] = earned;
        }
    }
&nbsp;
    /**
     * @dev Update LP reward per token
     */
<span class="fstat-no" title="function not covered" >    function _updateLPRewardPerToken() internal {</span>
<span class="cstat-no" title="statement not covered" >        if (totalLPStaked == 0) {</span>
            lpLastUpdateTime = block.timestamp;
<span class="cstat-no" title="statement not covered" >            return;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 timeElapsed = block.timestamp - lpLastUpdateTime;</span>
<span class="cstat-no" title="statement not covered" >        if (timeElapsed &gt; 0) {</span>
            lpRewardPerTokenStored += (lpRewardRate * timeElapsed * 1e18) / totalLPStaked;
            lpLastUpdateTime = block.timestamp;
        }
    }
&nbsp;
    // ============ VIEW FUNCTIONS ============
&nbsp;
    /**
     * @dev Get LP staking info for user
     */
<span class="fstat-no" title="function not covered" >    function getLPStakingInfo(address user) </span>
        external 
        view 
        returns (
            uint256 stakedAmount,
            uint256 rewardDebt,
            uint256 lastClaimTime,
            uint256 lockEndTime,
            uint256 lockBoost,
            uint256 pendingRewards
        ) 
    {
        stakedAmount = lpStakedAmount[user];
        rewardDebt = lpRewardDebt[user];
        lastClaimTime = lpLastClaimTime[user];
        lockEndTime = lpLockEndTime[user];
        lockBoost = lpLockBoost[user];
        
<span class="cstat-no" title="statement not covered" >        if (stakedAmount &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >            uint256 rewardPerToken = lpRewardPerTokenStored;</span>
<span class="cstat-no" title="statement not covered" >            if (totalLPStaked &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >                uint256 timeElapsed = block.timestamp - lpLastUpdateTime;</span>
                rewardPerToken += (lpRewardRate * timeElapsed * 1e18) / totalLPStaked;
    }
            pendingRewards = stakedAmount * (rewardPerToken - rewardDebt) / 1e18;
        }
    }
&nbsp;
    /**
     * @dev Get LP pool info
     */
<span class="fstat-no" title="function not covered" >    function getLPPoolInfo() </span>
        external 
        view 
        returns (
            uint256 totalStaked,
            uint256 rewardRate,
            uint256 lastUpdateTime,
            uint256 rewardPerTokenStored
        ) 
    {
<span class="cstat-no" title="statement not covered" >        return (totalLPStaked, lpRewardRate, lpLastUpdateTime, lpRewardPerTokenStored);</span>
    }
&nbsp;
    /**
     * @dev Check if user can unstake LP tokens
     */
<span class="fstat-no" title="function not covered" >    function canUnstakeLP(address user) external view returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        return block.timestamp &gt;= lpLockEndTime[user] &amp;&amp; lpStakedAmount[user] &gt; 0;</span>
    }
    
    /**
     * @dev Get remaining lock time for user
     */
<span class="fstat-no" title="function not covered" >    function getRemainingLockTime(address user) external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        if (block.timestamp &gt;= lpLockEndTime[user]) {</span>
<span class="cstat-no" title="statement not covered" >            return 0;</span>
        }
<span class="cstat-no" title="statement not covered" >        return lpLockEndTime[user] - block.timestamp;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _authorizeUpgrade(address newImplementation) internal override onlyRole(DEFAULT_ADMIN_ROLE) {}</span>
} </pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Jul 01 2025 17:55:23 GMT+0200 (közép-európai nyári idő)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
